## Spotify Complete Project

A full‑stack music app with a React frontend, a Python Flask backend, and a recommendation engine (k‑NN on Spotify audio features). The backend also serves the production React build, so you can run the whole app from a single process.

### Features
- **Search**: Find tracks via the Spotify Web API.
- **Stream preview**: Stream audio using YouTube as a source via `yt-dlp` and `ffmpeg`.
- **Recommendations**: k‑NN model returns similar tracks based on Spotify audio features.

### Tech stack
- **Frontend**: React (Create React App), TailwindCSS
- **Backend**: Python, Flask
- **ML**: scikit‑learn k‑NN model trained on a Spotify dataset

---

## Prerequisites
- **Python**: 3.9–3.11
- **Node.js**: 16+ (18 LTS recommended) and npm
- **Git**
- **ffmpeg**: Required by `yt-dlp` to extract audio
  - macOS: `brew install ffmpeg`
  - Ubuntu/Debian: `sudo apt update && sudo apt install -y ffmpeg`
  - Windows (Admin PowerShell): `choco install ffmpeg` (via Chocolatey)
- **Spotify Developer credentials**: Create an app at the Spotify Developer Dashboard to get `SPOTIFY_CLIENT_ID` and `SPOTIFY_CLIENT_SECRET`.

---

## Clone the repository
```bash
git clone <your-repo-url>
cd Spotify-Complete-Project
```

---

## 1) Backend setup (Flask + Recommender)
It’s best to use a Python virtual environment.

```bash
# From project root
python3 -m venv .venv
source .venv/bin/activate   # Windows: .venv\Scripts\activate
pip install --upgrade pip
pip install -r requirements.txt
```

### Configure environment variables
Create a `.env` file from the provided example and fill in your Spotify credentials.

```bash
cp example.env .env
# Open .env and set SPOTIFY_CLIENT_ID and SPOTIFY_CLIENT_SECRET
```

`.env` keys the app expects:
- `SPOTIFY_CLIENT_ID`
- `SPOTIFY_CLIENT_SECRET`

### Prepare the dataset and train the recommendation model
The recommender expects a CSV and a pickled k‑NN model.

```bash
# Unzip the dataset (creates recommendations/data/mergedFile.csv)
cd recommendations/data
unzip mergedFile.zip
cd ../..

# Train the model (creates recommendations/model/recommendation_model.pkl)
python recommendations/knn_model_train.py
```

If you skip training, the backend will fail when it tries to load the model.

---

## 2) Frontend setup (React)
Install Node dependencies and build the production bundle that the Flask server will serve.

```bash
cd frontend
npm install
npm run build
cd ..
```

This produces `frontend/build/`, which Flask serves at `/`.

---

## 3) Run the app
Start the Flask server from the project root. It will serve both the API and the built React app.

```bash
# From project root, with the virtualenv activated
python app.py
```

Open `http://127.0.0.1:5000` in your browser.

Notes:
- The React dev server (`npm start`) is not required; the app is designed to be served by Flask in production mode.
- If you change frontend code, re‑run `npm run build` for Flask to serve the updated UI.

---

## API endpoints
All endpoints are served from the Flask app on port 5000.

- `POST /api/search`
  - Body: `application/x-www-form-urlencoded` with `search_box=<song name>`
  - Example:
    ```bash
    curl -X POST \
      -d "search_box=Let it be" \
      http://127.0.0.1:5000/api/search
    ```

- `GET /api/stream?artist=<artist>&song=<title>`
  - Streams an MP3 response for the requested track
  - Example:
    ```bash
    curl -L \
      "http://127.0.0.1:5000/api/stream?artist=Haux&song=Seaside" \
      --output preview.mp3
    ```

- `GET /api/recommend/<spotifyTrackId>`
  - Returns a list of recommended tracks with metadata
  - Example:
    ```bash
    curl http://127.0.0.1:5000/api/recommend/0qlwDRhrYcE5JC07JbXTer
    ```

---

## Project structure
```
Spotify-Complete-Project/
├─ app.py                        # Flask app; serves API + frontend build
├─ requirements.txt              # Python dependencies
├─ example.env                   # Sample env vars (copy to .env)
├─ frontend/                     # React app (Create React App)
│  ├─ package.json
│  └─ build/                     # Generated by `npm run build`
└─ recommendations/              # Recommender assets
   ├─ data/
   │  ├─ mergedFile.zip          # Dataset archive
   │  └─ mergedFile.csv          # Unzipped dataset (create via unzip)
   ├─ knn_model_train.py         # Trains the k‑NN model
   ├─ model/
   │  └─ recommendation_model.pkl# Saved model (create via training)
   └─ recommender.py             # Model loader + inference
```

---

## Development tips (optional)
- The codebase is optimized to run via Flask serving the React build. Running `npm start` separately can cause CORS issues because no proxy is configured by default.
- If you prefer separate dev servers, you can add a `proxy` to `frontend/package.json` (e.g., `"proxy": "http://127.0.0.1:5000"`) and change any hardcoded absolute API URLs to relative ones. This repo is not preconfigured for that flow.

---

## Troubleshooting
- **ffmpeg not found / postprocessor error**: Install `ffmpeg` (see prerequisites) and ensure it is on your PATH.
- **Model file missing**: Run the training step to produce `recommendations/model/recommendation_model.pkl` and ensure `mergedFile.csv` exists (unzip the dataset first).
- **Spotify 401 / missing credentials**: Create `.env` and set `SPOTIFY_CLIENT_ID` and `SPOTIFY_CLIENT_SECRET`.
- **CORS errors in the browser**: Use the integrated mode (Flask serves the React build). Separate dev servers require additional proxy/CORS configuration.
- **Large memory usage on stream**: The streaming endpoint downloads audio into memory; avoid parallelizing many streams in development.

---

## License
For educational/demonstration purposes.


